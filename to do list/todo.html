<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Colorful To Do List App - Delete Only Completed</title>
<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
    display: flex;
    justify-content: center;
    padding: 15px 10px;
    height: 100vh;
    align-items: center;
  }
  #app {
    background: white;
    width: 350px;
    max-height: 600px;
    border-radius: 18px;
    box-shadow:
      0 8px 24px rgba(149, 157, 165, 0.2),
      0 4px 12px rgba(107, 114, 128, 0.1);
    display: flex;
    flex-direction: column;
    padding: 20px 25px;
  }
  h1 {
    text-align: center;
    font-weight: 800;
    margin-bottom: 24px;
    color: #283e51;
    user-select: none;
    text-shadow: 1px 1px 4px rgba(107, 114, 128, 0.3);
  }
  /* Input area */
  form#taskForm {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 20px;
  }
  input[type="text"] {
    flex-grow: 1;
    padding: 12px 14px;
    font-size: 1.05rem;
    border: 2px solid #a5d8ff;
    border-radius: 12px;
    transition: border-color 0.3s, box-shadow 0.3s;
    background: #eaf6ff;
    color: #084559;
    box-shadow: inset 0 2px 6px rgba(4, 69, 89, 0.1);
  }
  input[type="text"]::placeholder {
    color: #7ea9b6;
    font-style: italic;
  }
  input[type="text"]:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 8px 3px #60a5fa88;
    outline: none;
    background: #fff;
  }
  input[type="datetime-local"] {
    flex-basis: 180px;
    padding: 10px 14px;
    border: 2px solid #ff94c2;
    border-radius: 12px;
    font-size: 0.95rem;
    background: #fff0f6;
    color: #9d2449;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  input[type="datetime-local"]:focus {
    border-color: #ec4899;
    box-shadow: 0 0 8px 3px #f472b688;
    outline: none;
    background: #fff6fb;
  }
  button#addTaskBtn {
    flex-basis: 100%;
    background: linear-gradient(90deg, #f97316 0%, #f59e0b 100%);
    border: none;
    color: white;
    font-weight: 700;
    padding: 14px 0;
    border-radius: 14px;
    cursor: pointer;
    font-size: 1.15rem;
    user-select: none;
    transition: background 0.4s ease;
    box-shadow: 0 4px 12px #fbbf24aa;
    text-shadow: 0 0 3px rgba(255, 255, 255, 0.8);
  }
  button#addTaskBtn:hover {
    background: linear-gradient(90deg, #ef4444 0%, #f59e0b 100%);
  }
  /* Task list */
  ul#taskList {
    list-style: none;
    margin: 0;
    padding: 0;
    overflow-y: auto;
    flex-grow: 1;
    border-top: 2px solid #d6e4ff;
    border-radius: 0 0 18px 18px;
    background: #fdf8ff;
    box-shadow: inset 0 2px 10px #e2e2f1;
  }
  ul#taskList::-webkit-scrollbar {
    width: 6px;
  }
  ul#taskList::-webkit-scrollbar-thumb {
    background-color: #c084fc;
    border-radius: 10px;
  }
  li.taskItem {
    display: flex;
    align-items: center;
    padding: 12px 12px 12px 10px;
    border-bottom: 1px solid #ede7ff;
    gap: 12px;
    position: relative;
    transition: background-color 0.3s;
  }
  li.taskItem:last-child {
    border-bottom: none;
  }
  li.taskItem:hover {
    background-color: #fce7f3;
  }
  input[type="checkbox"].completeToggle {
    width: 22px;
    height: 22px;
    cursor: pointer;
    accent-color: #a855f7;
    border-radius: 6px;
    box-shadow: 0 0 6px #d8b4fe88;
  }
  input[type="checkbox"].completeToggle:focus {
    outline-offset: 2px;
    outline-color: #8b5cf6;
    outline-style: solid;
    outline-width: 2px;
  }
  .taskContent {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    user-select: none;
  }
  .taskText {
    font-size: 1.02rem;
    font-weight: 600;
    color: #4b3063;
    word-break: break-word;
    transition: color 0.3s, text-decoration 0.3s;
  }
  .taskText.completed {
    text-decoration: line-through;
    color: #a78bfa;
  }
  .taskDatetime {
    font-size: 0.85rem;
    font-weight: 600;
    color: #a78bfa;
    margin-top: 2px;
  }
  /* Buttons: edit, delete, move up/down */
  div.taskActions {
    display: flex;
    flex-direction: row;
    gap: 10px;
    user-select: none;
  }
  button.actionBtn {
    border: none;
    background-color: #ffffffdd;
    color: #8b5cf6;
    cursor: pointer;
    padding: 6px 8px;
    border-radius: 12px;
    transition: background-color 0.3s, color 0.3s, transform 0.15s ease;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 6px #c4b5fdcc;
  }
  button.actionBtn:hover {
    background-color: #a78bfa;
    color: white;
    transform: scale(1.1);
  }
  /* Delete button hidden by default and shown if completed */
  button.actionBtn.deleteBtn {
    display: none;
  }
  li.taskItem.completedTask button.deleteBtn {
    display: flex;
  }
  /* Edit mode */
  input.editText,
  input.editDatetime {
    width: 100%;
    padding: 8px 12px;
    font-size: 1rem;
    font-weight: 600;
    border: 2px solid #a78bfa;
    border-radius: 12px;
    box-shadow: 0 0 8px #c4b5fdcc inset;
    transition: box-shadow 0.3s ease;
    background-color: #faf5ff;
    color: #4c1d95;
  }
  input.editText:focus,
  input.editDatetime:focus {
    box-shadow: 0 0 12px #9333ea;
    outline: none;
    background-color: #f5f3ff;
  }
  /* Buttons container for save/cancel */
  .editButtons {
    display: flex;
    gap: 10px;
    margin-top: 6px;
    justify-content: flex-end;
  }
  .editButtons button {
    flex: 1 1 50%;
    border-radius: 16px;
    font-weight: 700;
    font-size: 1rem;
    padding: 10px 0;
  }
  .editButtons button.saveBtn {
    background-color: #7c3aed;
    color: #fff;
    box-shadow: 0 4px 14px #9333ea99;
    border: none;
    transition: background-color 0.3s ease;
  }
  .editButtons button.saveBtn:hover {
    background-color: #6d28d9;
  }
  .editButtons button.cancelBtn {
    background-color: #ec4899;
    color: #fff;
    box-shadow: 0 4px 14px #f43f5eff;
    border: none;
    transition: background-color 0.3s ease;
  }
  .editButtons button.cancelBtn:hover {
    background-color: #be185d;
  }
  /* Responsive: ensure no overflow */
  @media (max-width: 400px) {
    #app {
      width: 95vw;
      max-height: 600px;
      padding: 15px 15px;
    }
    input[type="datetime-local"] {
      flex-basis: 100%;
    }
    button#addTaskBtn {
      flex-basis: 100%;
    }
  }
</style>
</head>
<body>
<div id="app" role="main" aria-label="To Do List App">
  <h1>To Do List</h1>
  <form id="taskForm" aria-label="Add new task form">
    <input type="text" id="taskInput" placeholder="Enter a new task..." aria-label="Task description" required autocomplete="off" />
    <input type="datetime-local" id="datetimeInput" aria-label="Set date and time for task" />
    <button type="submit" id="addTaskBtn" aria-label="Add task button">Add Task</button>
  </form>
  <ul id="taskList" aria-live="polite" aria-relevant="additions removals" aria-label="Task list"></ul>
</div>

<script>
  (() => {
    const taskForm = document.getElementById('taskForm');
    const taskInput = document.getElementById('taskInput');
    const datetimeInput = document.getElementById('datetimeInput');
    const taskList = document.getElementById('taskList');

    let tasks = [];

    // Save tasks to localStorage
    function saveTasks() {
      localStorage.setItem('todoTasks', JSON.stringify(tasks));
    }

    // Load tasks from localStorage
    function loadTasks() {
      const saved = localStorage.getItem('todoTasks');
      if (saved) {
        tasks = JSON.parse(saved);
        tasks.forEach(t => {
          t.datetime = t.datetime ? new Date(t.datetime).toISOString() : null;
        });
      }
    }

    // Format date for display
    function formatDateTime(dateStr) {
      if (!dateStr) return '';
      const d = new Date(dateStr);
      if (isNaN(d)) return '';
      return d.toLocaleString(undefined, {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });
    }

    // Render a single task item to DOM element
    function createTaskElement(task, index) {
      const li = document.createElement('li');
      li.className = 'taskItem';
      if(task.completed) li.classList.add('completedTask');
      li.setAttribute('data-index', index);
      li.setAttribute('tabindex', '-1');

      // Checkbox for complete
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.className = 'completeToggle';
      checkbox.checked = task.completed;
      checkbox.setAttribute('aria-label', task.completed ? `Mark task "${task.text}" as incomplete` : `Mark task "${task.text}" as completed`);

      // Task content wrapper
      const content = document.createElement('div');
      content.className = 'taskContent';

      // Task text span
      const taskText = document.createElement('span');
      taskText.className = 'taskText';
      if (task.completed) taskText.classList.add('completed');
      taskText.textContent = task.text;
      taskText.setAttribute('aria-label', `Task: ${task.text}${task.datetime ? ', due ' + formatDateTime(task.datetime) : ''}`);

      // Task date/time span
      const taskDateTime = document.createElement('span');
      taskDateTime.className = 'taskDatetime';
      taskDateTime.textContent = task.datetime ? formatDateTime(task.datetime) : '';
      taskDateTime.setAttribute('aria-hidden', 'true');

      content.appendChild(taskText);
      if (task.datetime) {
        content.appendChild(taskDateTime);
      }

      // Actions container
      const actions = document.createElement('div');
      actions.className = 'taskActions';

      // Edit button
      const editBtn = document.createElement('button');
      editBtn.className = 'actionBtn';
      editBtn.setAttribute('title', 'Edit task');
      editBtn.setAttribute('aria-label', `Edit task: ${task.text}`);
      editBtn.innerHTML = '&#9998;';

      // Delete button - only visible when completed by CSS
      const delBtn = document.createElement('button');
      delBtn.className = 'actionBtn deleteBtn';
      delBtn.setAttribute('title', 'Delete task');
      delBtn.setAttribute('aria-label', `Delete task: ${task.text}`);
      delBtn.innerHTML = '&#128465;';

      // Move up button
      const moveUpBtn = document.createElement('button');
      moveUpBtn.className = 'actionBtn';
      moveUpBtn.setAttribute('title', 'Move task up');
      moveUpBtn.setAttribute('aria-label', `Move task up: ${task.text}`);
      moveUpBtn.innerHTML = '&#8593;';

      // Move down button
      const moveDownBtn = document.createElement('button');
      moveDownBtn.className = 'actionBtn';
      moveDownBtn.setAttribute('title', 'Move task down');
      moveDownBtn.setAttribute('aria-label', `Move task down: ${task.text}`);
      moveDownBtn.innerHTML = '&#8595;';

      actions.appendChild(editBtn);
      actions.appendChild(delBtn);
      actions.appendChild(moveUpBtn);
      actions.appendChild(moveDownBtn);

      li.appendChild(checkbox);
      li.appendChild(content);
      li.appendChild(actions);

      // Events
      checkbox.addEventListener('change', () => {
        tasks[index].completed = checkbox.checked;
        saveTasks();
        renderTasks();
      });

      delBtn.addEventListener('click', () => {
        if(tasks[index].completed) {
          if (confirm('Delete this completed task?')) {
            tasks.splice(index, 1);
            saveTasks();
            renderTasks();
            taskInput.focus();
          }
        } else {
          alert('You can only delete tasks once they are marked completed.');
        }
      });

      moveUpBtn.addEventListener('click', () => {
        if (index > 0) {
          [tasks[index], tasks[index - 1]] = [tasks[index - 1], tasks[index]];
          saveTasks();
          renderTasks();
        }
      });

      moveDownBtn.addEventListener('click', () => {
        if (index < tasks.length - 1) {
          [tasks[index], tasks[index + 1]] = [tasks[index + 1], tasks[index]];
          saveTasks();
          renderTasks();
        }
      });

      editBtn.addEventListener('click', () => enterEditMode(li, task, index));

      return li;
    }

    // Edit mode
    function enterEditMode(taskElement, task, index) {
      const contentDiv = taskElement.querySelector('.taskContent');
      const actionsDiv = taskElement.querySelector('.taskActions');
      const checkbox = taskElement.querySelector('input.completeToggle');

      contentDiv.style.display = 'none';
      actionsDiv.style.display = 'none';
      checkbox.disabled = true;

      const editDiv = document.createElement('div');
      editDiv.style.flexGrow = '1';
      editDiv.style.display = 'flex';
      editDiv.style.flexDirection = 'column';
      editDiv.style.gap = '6px';

      const editText = document.createElement('input');
      editText.type = 'text';
      editText.className = 'editText';
      editText.value = task.text;
      editText.setAttribute('aria-label', `Edit task description for task: ${task.text}`);
      editText.required = true;

      const editDateTime = document.createElement('input');
      editDateTime.type = 'datetime-local';
      editDateTime.className = 'editDatetime';
      editDateTime.value = task.datetime ? task.datetime.substring(0, 16) : '';
      editDateTime.setAttribute('aria-label', `Edit date and time for task: ${task.text}`);

      const btnContainer = document.createElement('div');
      btnContainer.className = 'editButtons';

      const saveBtn = document.createElement('button');
      saveBtn.className = 'saveBtn';
      saveBtn.textContent = 'Save';
      saveBtn.setAttribute('aria-label', `Save edits for task: ${task.text}`);

      const cancelBtn = document.createElement('button');
      cancelBtn.className = 'cancelBtn';
      cancelBtn.textContent = 'Cancel';
      cancelBtn.setAttribute('aria-label', `Cancel edits for task: ${task.text}`);

      btnContainer.appendChild(saveBtn);
      btnContainer.appendChild(cancelBtn);

      editDiv.appendChild(editText);
      editDiv.appendChild(editDateTime);
      editDiv.appendChild(btnContainer);

      taskElement.appendChild(editDiv);

      editText.focus();
      editText.selectionStart = editText.selectionEnd = editText.value.length;

      saveBtn.addEventListener('click', () => {
        const newText = editText.value.trim();
        if (!newText) {
          alert('Task description cannot be empty.');
          editText.focus();
          return;
        }
        const newDateTime = editDateTime.value ? new Date(editDateTime.value).toISOString() : null;
        if (newDateTime && isNaN(Date.parse(newDateTime))) {
          alert('Invalid date/time format.');
          editDateTime.focus();
          return;
        }
        tasks[index].text = newText;
        tasks[index].datetime = newDateTime;
        saveTasks();
        renderTasks();
      });

      cancelBtn.addEventListener('click', () => {
        editDiv.remove();
        contentDiv.style.display = '';
        actionsDiv.style.display = '';
        checkbox.disabled = false;
        checkbox.focus();
      });
    }

    // Render all tasks
    function renderTasks() {
      taskList.innerHTML = '';
      tasks.forEach((task, index) => {
        const taskEl = createTaskElement(task, index);
        taskList.appendChild(taskEl);
      });
    }

    // Add new task
    taskForm.addEventListener('submit', e => {
      e.preventDefault();
      const text = taskInput.value.trim();
      if (!text) return;
      const datetimeVal = datetimeInput.value;
      const datetime = datetimeVal ? new Date(datetimeVal).toISOString() : null;

      tasks.push({
        text,
        datetime,
        completed: false
      });
      saveTasks();
      renderTasks();
      taskInput.value = '';
      datetimeInput.value = '';
      taskInput.focus();
    });

    // Initialize
    function init() {
      loadTasks();
      renderTasks();
    }
    init();

  })();
</script>
</body>
</html>
